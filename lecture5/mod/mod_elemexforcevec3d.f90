MODULE mod_elemexforcevec3d
!####################################################################

USE mod_nodes3d
USE mod_localelement3d
USE mod_elements3d

!--------------------------------------------------------------------

IMPLICIT NONE

!--------------------------------------------------------------------

TYPE :: struct_elemexforcevec3d

  !--------------------------------------------------------

  PRIVATE

  !--------------------------------------------------------

  TYPE(struct_nodes3d), POINTER        :: ns3d => NULL()
  TYPE(struct_localelement3d), POINTER :: le3d => NULL()
  TYPE(struct_elements3d), POINTER     :: es3d => NULL()

  !--------------------------------------------------------
  !
  ! f(:, :)
  ! Element external force vector
  !
  !--------------------------------------------------------

  ! rho(:)
  ! Density
  !
  ! g
  ! Gravitational acceleration
  !
  !--------------------------------------------------------

  REAL(8), ALLOCATABLE :: f(:, :)
  REAL(8), ALLOCATABLE :: rho(:)
  REAL(8) :: g

  !--------------------------------------------------------

END TYPE struct_elemexforcevec3d

!--------------------------------------------------------------------

CONTAINS


! Get element external force vector
!####################################################################
SUBROUTINE get_elemexforcevec3d_f(efv3d, f)
!####################################################################

  TYPE(struct_elemexforcevec3d), INTENT(IN) :: efv3d

  REAL(8), INTENT(OUT) :: f(:, :)

  !--------------------------------------------------------------------

  f = efv3d%f

  !--------------------------------------------------------------------

  RETURN

!####################################################################
END SUBROUTINE get_elemexforcevec3d_f
!####################################################################


! Set density
!####################################################################
SUBROUTINE set_elemexforcevec3d_rho(efv3d, rho)
!####################################################################

  TYPE(struct_elemexforcevec3d), INTENT(INOUT) :: efv3d

  REAL(8), INTENT(IN) :: rho(:)

  !--------------------------------------------------------------------

  efv3d%rho = rho

  !--------------------------------------------------------------------

  RETURN

!####################################################################
END SUBROUTINE set_elemexforcevec3d_rho
!####################################################################


! Get density
!####################################################################
SUBROUTINE get_elemexforcevec3d_rho(efv3d, rho)
!####################################################################

  TYPE(struct_elemexforcevec3d), INTENT(IN) :: efv3d

  REAL(8), INTENT(OUT) :: rho(:)

  !--------------------------------------------------------------------

  rho = efv3d%rho

  !--------------------------------------------------------------------

  RETURN

!####################################################################
END SUBROUTINE get_elemexforcevec3d_rho
!####################################################################


! Set gravitational acceleration
!####################################################################
SUBROUTINE set_elemexforcevec3d_g(efv3d, g)
!####################################################################

  TYPE(struct_elemexforcevec3d), INTENT(INOUT) :: efv3d

  REAL(8), INTENT(IN) :: g

  !--------------------------------------------------------------------

  efv3d%g = g

  !--------------------------------------------------------------------

  RETURN

!####################################################################
END SUBROUTINE set_elemexforcevec3d_g
!####################################################################


! Get gravitational acceleration
!####################################################################
SUBROUTINE get_elemexforcevec3d_g(efv3d, g)
!####################################################################

  TYPE(struct_elemexforcevec3d), INTENT(IN) :: efv3d

  REAL(8), INTENT(OUT) :: g

  !--------------------------------------------------------------------

  g = efv3d%g

  !--------------------------------------------------------------------

  RETURN

!####################################################################
END SUBROUTINE get_elemexforcevec3d_g
!####################################################################


!####################################################################
SUBROUTINE init_elemexforcevec3d(efv3d, ns3d, le3d, es3d)
!####################################################################

  TYPE(struct_elemexforcevec3d), INTENT(INOUT) :: efv3d

  TYPE(struct_nodes3d), TARGET, INTENT(IN)        :: ns3d
  TYPE(struct_localelement3d), TARGET, INTENT(IN) :: le3d
  TYPE(struct_elements3d), TARGET, INTENT(IN)     :: es3d

  !--------------------------------------------------------------------

  INTEGER :: le3d_nnodes
  INTEGER :: es3d_n

  !--------------------------------------------------------------------

  efv3d%ns3d => ns3d
  efv3d%le3d => le3d
  efv3d%es3d => es3d

  !--------------------------------------------------------------------

  CALL get_localelement3d_nnodes(efv3d%le3d, le3d_nnodes)

  CALL get_elements3d_n(efv3d%es3d, es3d_n)

  !--------------------------------------------------------------------

  ALLOCATE( efv3d%f(3*le3d_nnodes, es3d_n) )

  efv3d%f = 0.0D0

  !--------------------------------------------------------------

  ALLOCATE( efv3d%rho(es3d_n) )

  efv3d%rho = 0.0D0

  efv3d%g = 0.0D0

  !--------------------------------------------------------------------

  RETURN

!####################################################################
END SUBROUTINE init_elemexforcevec3d
!####################################################################

!####################################################################
SUBROUTINE cal_elemexforcevec3d(efv3d)
!####################################################################

  TYPE(struct_elemexforcevec3d), INTENT(INOUT) :: efv3d

  !--------------------------------------------------------------------

  !--------------------------------------------------------------------

  RETURN

!####################################################################
END SUBROUTINE cal_elemexforcevec3d
!####################################################################

!####################################################################
SUBROUTINE del_elemexforcevec3d(efv3d)
!####################################################################

  TYPE(struct_elemexforcevec3d), INTENT(INOUT) :: efv3d

  !--------------------------------------------------------------------

  NULLIFY( efv3d%ns3d )
  NULLIFY( efv3d%le3d )
  NULLIFY( efv3d%es3d )

  !--------------------------------------------------------------------

  DEALLOCATE( efv3d%f )

  !--------------------------------------------------------------

  DEALLOCATE( efv3d%rho )

  efv3d%g = 0.0D0

  !--------------------------------------------------------------------

  RETURN

!####################################################################
END SUBROUTINE del_elemexforcevec3d
!####################################################################


!####################################################################
END MODULE mod_elemexforcevec3d
